import Head from "next/head";
import Title from "@/components/Title";

import { AnimatePresence, motion } from "framer-motion";
import { useRouter } from "next/router";

import SearchMediaHandler from "@/features/searchMedia/components/SearchMediaHandler";
import DiscoverFilter from "@/features/pages/discover/components/DiscoverFilter";
import DiscoverInitialText from "@/features/pages/discover/components/DiscoverInitialText";
import useDiscoverSearch from "@/features/pages/discover/hooks/useDiscoverSearch";

export default function Discover() {
   const { asPath, query } = useRouter();
   const { apiUrl } = useDiscoverSearch();
   return (
      <div className="">
         <Head>
            <title>Discover</title>
            <meta name="description" content="Generated by create next app" />
            <link rel="icon" href="/favicon.ico" />
         </Head>
         <div className="relative w-full">
            <Title title="Discover">
               <DiscoverFilter />
            </Title>
         </div>
         <motion.div exit={{ opacity: 0, transition: { duration: 0.4 } }}>
            <AnimatePresence mode="wait">
               {apiUrl ? (
                  <SearchMediaHandler
                     key={asPath}
                     mediaType={query.media_type as "tv" | "movie"}
                     apiUrl={apiUrl}
                  />
               ) : (
                  <DiscoverInitialText />
               )}
            </AnimatePresence>
         </motion.div>
      </div>
   );
}
