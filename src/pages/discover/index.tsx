import Head from "next/head";
import { useRouter } from "next/router";
import { FormEvent } from "react";
import DropDown from "../../components/discover/DropDown";
import PageTitle from "../../components/PageTitle";
import {
   ratings,
   sortByMovie,
   sortByTv,
   movieGenresOptions,
   tvGenresOptions,
   releaseYears,
} from "../../data/discover/options";
import useDropDownValues from "../../hooks/useDropDownValues";
import useLanguages from "../../hooks/useLanguages";

export default function Discover() {
   const router = useRouter();
   const {
      isMovie,
      toggle,
      language,
      setLanguage,
      genre,
      setGenre,
      year,
      setYear,
      rating,
      setRating,
      sortBy,
      setSortBy,
   } = useDropDownValues();

   const handleSubmit = (e: FormEvent) => {
      e.preventDefault();
      const mediaType = isMovie ? "movie" : "tv";

      const languageQuery = `&with_original_language=${language.value}`;
      const genreQuery = `&with_genres=${genre.value}`;
      const yearQuery = `&${isMovie ? "year" : "first_air_date_year"}=${
         year.value
      }`;
      const ratingQuery = `&vote_average.gte=${rating.value}`;
      const sortByQuery = `&sort_by=${sortBy.value}`;

      const searchTerm =
         languageQuery + genreQuery + yearQuery + ratingQuery + sortByQuery;

      router.push(`/discover/${mediaType}?${searchTerm}`);
   };

   const { languagesOptions } = useLanguages();

   return (
      <div>
         <Head>
            <title>Discover</title>
            <meta name="description" content="Generated by create next app" />
            <link rel="icon" href="/favicon.ico" />
         </Head>
         <PageTitle>Discover</PageTitle>
         <form onSubmit={handleSubmit} className="">
            <button
               type="button"
               onClick={toggle}
               className="px-5 py-3 rounded-xl bg-blue-500 flex space-x-1"
            >
               <span>Search:</span>
               <span>{isMovie ? "Movies" : "TV Shows"}</span>
            </button>
            <div className="grid gap-5 sm:grid-cols-2 md:grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 2xl:px-20">
               <DropDown
                  title="Languages"
                  options={languagesOptions}
                  value={language}
                  setValue={setLanguage}
               />
               <DropDown
                  title="Genres"
                  options={isMovie ? movieGenresOptions : tvGenresOptions}
                  value={genre}
                  setValue={setGenre}
               />
               <DropDown
                  title="Year of Release"
                  options={releaseYears}
                  value={year}
                  setValue={setYear}
               />
               <DropDown
                  title="Rating"
                  options={ratings}
                  value={rating}
                  setValue={setRating}
               />
               <DropDown
                  title="Sort By"
                  options={isMovie ? sortByMovie : sortByTv}
                  value={sortBy}
                  setValue={setSortBy}
               />
            </div>

            <button
               type="submit"
               className="px-5 py-3 rounded-xl bg-blue-500 mx-auto block mt-5"
            >
               Search
            </button>
         </form>
      </div>
   );
}
